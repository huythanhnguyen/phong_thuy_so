<template>
  <div class="min-h-screen flex flex-col">
    <Header />
    
    <main class="flex-grow container mx-auto px-4 py-12">
      <div class="max-w-4xl mx-auto">
        <h1 class="text-4xl font-bold text-gray-800 mb-8 text-center">Ch·ªçn M·∫≠t Kh·∫©u Theo Phong Th·ªßy</h1>
    
    <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
      <p class="text-lg text-gray-700 mb-6">
        M·∫≠t kh·∫©u kh√¥ng ch·ªâ l√† y·∫øu t·ªë b·∫£o m·∫≠t m√† c√≤n c√≥ th·ªÉ mang l·∫°i may m·∫Øn v√† t√†i l·ªôc n·∫øu ƒë∆∞·ª£c ch·ªçn ƒë√∫ng theo nguy√™n l√Ω phong th·ªßy.
      </p>
      
          <div class="border-l-4 border-primary p-4 bg-primary-light mb-8">
            <h3 class="font-bold text-lg mb-2">L∆∞u √Ω quan tr·ªçng</h3>
            <p>ƒê√¢y l√† b·∫£n demo ch·ªâ t·∫°o chu·ªói s·ªë. N·∫øu b·∫°n mu·ªën th√™m ch·ªØ c√°i ho·∫∑c k√Ω t·ª± ƒë·∫∑c bi·ªát, vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n th√™m.</p>
          </div>
          
          <div class="border-l-4 border-yellow-500 p-4 bg-yellow-50 mb-8">
            <h3 class="font-bold text-lg text-yellow-700 mb-2">C√°c nguy√™n t·∫Øc m·∫≠t kh·∫©u phong th·ªßy</h3>
            <ul class="list-disc pl-5 space-y-2 text-gray-700">
              <li><strong>Ph∆∞∆°ng ph√°p ph√¢n t√≠ch:</strong> D√£y s·ªë ƒë∆∞·ª£c ph√¢n t√≠ch t·ª´ng c·∫∑p t·ª´ tr√°i qua ph·∫£i, v√≠ d·ª•: 918 = 91 + 18 = (Di√™n Ni√™n + Ng≈© Qu·ª∑)</li>
              <li><strong>Tr·ªçng ƒëi·ªÉm t√¢m kinh:</strong> 2 s·ªë cu·ªëi c√πng c·ªßa m·∫≠t kh·∫©u ƒë·∫∑c bi·ªát quan tr·ªçng, n√™n l√† c·∫∑p sao t·ªët</li>
              <li>D√πng <strong>Di√™n Ni√™n</strong> ·ªü cu·ªëi d√£y s·ªë cho hi·ªáu nƒÉng l·ª±c, hi·ªáu th·ª≠ t√†i</li>
              <li>D√πng <strong>Thi√™n Y</strong> ·ªü cu·ªëi d√£y s·ªë cho hi·ªáu ki·∫øm ti·ªÅn, hi·ªáu t√¨nh c·∫£m</li>
              <li>D√πng <strong>Sinh Kh√≠</strong> ·ªü cu·ªëi d√£y s·ªë cho hi·ªáu vui v·∫ª, hi·ªáu b·∫±ng h·ªØu</li>
              <li>Ho·∫∑c tr∆∞·ªõc s·ªë th·ª© ba t·ª´ cu·ªëi th√™m 5 (ti·∫øp t·ª•c ch·ªânh nƒÉng l∆∞·ª£ng)</li>
              <li>Ho·∫∑c tr∆∞·ªõc s·ªë th·ª© ba t·ª´ cu·ªëi th√™m Ph·ª•c V·ªã (ti·∫øp t·ª•c ch·ªânh nƒÉng l∆∞·ª£ng)</li>
              <li><strong>Tuy·ªát ƒë·ªëi tr√°nh:</strong> S·ªë 0 ·ªü cu·ªëi d√£y s·ªë (h·ª£p th√†nh s·∫Ω bi·∫øn kh√¥ng t∆∞·ª£ng)</li>
              <li><strong>Tuy·ªát ƒë·ªëi tr√°nh:</strong> Hung tinh ·ªü cu·ªëi d√£y s·ªë nh∆∞ Ng≈© Qu·ª∑, Tuy·ªát M·ªánh (h·ª£p th√†nh s·∫Ω chuy·ªÉn bi·∫øn x·∫•u)</li>
              <li><strong>Tuy·ªát ƒë·ªëi tr√°nh:</strong> Hai hung tinh li·ªÅn k·ªÅ nhau (s·∫Ω g√¢y ra ƒëi·ªÅm x·∫•u v√† r·ªßi ro)</li>
            </ul>
          </div>
        </div>
        
        <!-- Ph·∫ßn ch·ªçn m·ª•c ƒë√≠ch -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">M·ª•c ƒë√≠ch s·ª≠ d·ª•ng m·∫≠t kh·∫©u</h2>
          <p class="mb-4">Ch·ªçn m·ª•c ƒë√≠ch s·ª≠ d·ª•ng m·∫≠t kh·∫©u ƒë·ªÉ nh·∫≠n g·ª£i √Ω ph√π h·ª£p</p>
          
          <div class="grid md:grid-cols-3 gap-4 mb-6">
            <div 
              v-for="(purpose, index) in purposes" 
              :key="index"
              class="border rounded-lg p-4 cursor-pointer transition-all duration-300"
              :class="selectedPurpose === purpose.value ? 'border-primary bg-primary-light shadow-md' : 'border-gray-200 hover:border-primary hover:shadow'"
              @click="selectedPurpose = purpose.value"
            >
              <div class="flex items-center">
                <div class="w-5 h-5 rounded-full border mr-3 flex items-center justify-center" 
                     :class="selectedPurpose === purpose.value ? 'border-primary' : 'border-gray-400'">
                  <div v-if="selectedPurpose === purpose.value" class="w-3 h-3 rounded-full bg-primary"></div>
                </div>
                <span>{{ purpose.label }}</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Ph·∫ßn ƒë·ªô d√†i m·∫≠t kh·∫©u -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">ƒê·ªô d√†i m·∫≠t kh·∫©u</h2>
          <p class="mb-4">Ch·ªçn s·ªë l∆∞·ª£ng k√Ω t·ª± cho m·∫≠t kh·∫©u c·ªßa b·∫°n</p>
          
          <div class="flex items-center mb-6">
            <button 
              @click="decrementLength" 
              class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center hover:bg-gray-300 focus:outline-none"
              :disabled="passwordLength <= 4"
            >
              <span class="text-xl">-</span>
            </button>
            
            <div class="mx-4 px-6 py-2 border rounded-lg text-center min-w-[80px]">
              {{ passwordLength }}
            </div>
            
            <button 
              @click="incrementLength" 
              class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center hover:bg-gray-300 focus:outline-none"
              :disabled="passwordLength >= 12"
            >
              <span class="text-xl">+</span>
            </button>
          </div>
        </div>
        
        <!-- Ph·∫ßn g·ª£i √Ω m·∫≠t kh·∫©u -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">M·∫≠t kh·∫©u g·ª£i √Ω</h2>
          
          <div v-if="!selectedPurpose" class="text-center py-6 text-gray-500">
            Vui l√≤ng ch·ªçn m·ª•c ƒë√≠ch s·ª≠ d·ª•ng ƒë·ªÉ nh·∫≠n g·ª£i √Ω
          </div>
          
          <div v-else>
            <div class="mb-6">
              <p class="mb-2">C·∫∑p sao t∆∞∆°ng ·ª©ng: <span class="font-semibold">{{ getStars() }}</span></p>
              <p class="mt-2 text-gray-600 text-sm">{{ getPurposeDescription() }}</p>
              <div class="mt-4 border-l-4 border-primary p-4 bg-primary-light">
                <h4 class="font-bold mb-2">H∆∞·ªõng d·∫´n c·∫∑p s·ªë cu·ªëi</h4>
                <p class="text-sm" v-if="selectedPurpose === 'wealth'">
                  D√πng <strong>Thi√™n Y</strong> (13, 31, 68, 86) ·ªü cu·ªëi d√£y s·ªë cho hi·ªáu ki·∫øm ti·ªÅn.
                </p>
                <p class="text-sm" v-else-if="selectedPurpose === 'career'">
                  D√πng <strong>Di√™n Ni√™n</strong> (19, 91, 34, 43) ·ªü cu·ªëi d√£y s·ªë cho hi·ªáu nƒÉng l·ª±c, th·ª≠ t√†i.
                </p>
                <p class="text-sm" v-else-if="selectedPurpose === 'health'">
                  D√πng <strong>Sinh Kh√≠</strong> (39, 93, 14, 41) ·ªü cu·ªëi d√£y s·ªë cho hi·ªáu s·ª©c kh·ªèe, ho·∫∑c <strong>Thi√™n Y</strong> (13, 31) ƒë·ªÉ c√¢n b·∫±ng tinh th·∫ßn.
                </p>
                <p class="text-sm" v-else-if="selectedPurpose === 'love'">
                  T·ªï h·ª£p <strong>Sinh Kh√≠ + Thi√™n Y</strong> ho·∫∑c <strong>Thi√™n Y + Thi√™n Y</strong> ·ªü gi·ªØa ho·∫∑c cu·ªëi s·ªë ƒë·ªÅu mang ƒë·∫øn h√¥n nh√¢n v√† t√¨nh y√™u.
                </p>
                <p class="text-sm" v-else-if="selectedPurpose === 'education'">
                  D√πng t·ªï h·ª£p <strong>Sinh Kh√≠ + Di√™n Ni√™n + Sinh Kh√≠</strong> ƒë·ªÉ tƒÉng hi·ªáu qu·∫£ h·ªçc t·∫≠p, c√≥ qu√Ω nh√¢n h·ªó tr·ª£.
                </p>
                <p class="text-sm" v-else-if="selectedPurpose === 'investment'">
                  K·∫øt h·ª£p <strong>Tuy·ªát M·ªánh + Thi√™n Y</strong> (21, 31 ho·∫∑c 13) gi√∫p tƒÉng n·ªó l·ª±c ph·∫•n ƒë·∫•u v√† c√≥ m·∫°ch suy nghƒ© ƒë·∫ßu t∆∞ t·ªët.
                </p>
              </div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-4 mb-6">
              <div v-for="(password, index) in suggestedPasswords" :key="index" 
                class="border border-gray-200 rounded-lg p-4 relative hover:shadow-md transition-shadow">
                <div class="text-xl font-mono mb-2 text-center">{{ password }}</div>
                <div class="text-xs text-gray-500 text-center mb-2">{{ passwordExplanations[index] }}</div>
                <button 
                  @click="copyToClipboard(password)" 
                  class="absolute top-2 right-2 text-gray-500 hover:text-primary"
                  title="Sao ch√©p"
                >
                  <span>üìã</span>
                </button>
              </div>
            </div>
            
            <div class="text-center">
              <button 
                @click="generatePasswords" 
                class="px-6 py-3 bg-primary text-white rounded-md hover:bg-primary-dark transition-colors shadow-md"
              >
                G·ª£i √Ω m·∫≠t kh·∫©u kh√°c
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>
    
    <Footer />
  </div>
</template>

<script setup>
import { ref, computed, watch } from 'vue'
import Header from '@/components/layout/Header.vue'
import Footer from '@/components/layout/Footer.vue'

// Tr·∫°ng th√°i
const selectedPurpose = ref('')
const passwordLength = ref(6)
const suggestedPasswords = ref([])
const passwordExplanations = ref([])
const copyMessage = ref('')

// Danh s√°ch m·ª•c ƒë√≠ch
const purposes = [
  { value: 'wealth', label: 'T√†i l·ªôc' },
  { value: 'career', label: 'S·ª± nghi·ªáp' },
  { value: 'health', label: 'S·ª©c kh·ªèe' },
  { value: 'love', label: 'T√¨nh duy√™n' },
  { value: 'education', label: 'H·ªçc t·∫≠p' },
  { value: 'investment', label: 'ƒê·∫ßu t∆∞' }
]

// D·ªØ li·ªáu phong th·ªßy
const fengShuiData = {
  wealth: {
    stars: 'Thi√™n Y',
    luckyNumbers: ['1', '3', '9'], 
    combinations: ['13', '31', '39', '93', '18', '81', '19', '91'],
    description: 'M·∫≠t kh·∫©u t√†i l·ªôc gi√∫p thu h√∫t ti·ªÅn b·∫°c, mang t·ªõi v·∫≠n may t√†i ch√≠nh'
  },
  career: {
    stars: 'Di√™n Ni√™n',
    luckyNumbers: ['1', '3', '9'], 
    combinations: ['91', '19', '31', '13', '93', '39'],
    description: 'TƒÉng c∆∞·ªùng nƒÉng l·ª±c chuy√™n nghi·ªáp, h·ªó tr·ª£ thƒÉng ti·∫øn trong s·ª± nghi·ªáp'
  },
  health: {
    stars: 'Sinh Kh√≠ - Thi√™n Y',
    luckyNumbers: ['1', '3', '9'], 
    combinations: ['39', '93', '13', '31', '14', '41'],
    description: 'Gi√∫p duy tr√¨ s·ª©c kh·ªèe t·ªët, c√¢n b·∫±ng tinh th·∫ßn v√† th·ªÉ ch·∫•t'
  },
  love: {
    stars: 'Sinh Kh√≠ + Thi√™n Y, Thi√™n Y + Thi√™n Y',
    luckyNumbers: ['1', '3', '9'], 
    combinations: ['31', '13', '21', '12', '23', '32'],
    description: 'TƒÉng c∆∞·ªùng duy√™n ph·∫≠n, h·ªó tr·ª£ t√¨nh c·∫£m h√≤a h·ª£p, ng·ªçt ng√†o'
  },
  education: {
    stars: 'Sinh Kh√≠ + Di√™n Ni√™n + Sinh Kh√≠',
    luckyNumbers: ['1', '3', '9'], 
    combinations: ['81', '18', '36', '63', '38', '83'],
    description: 'Ph√°t tri·ªÉn tr√≠ tu·ªá, tƒÉng c∆∞·ªùng kh·∫£ nƒÉng h·ªçc t·∫≠p v√† t∆∞ duy'
  },
  investment: {
    stars: 'Tuy·ªát M·ªánh + Thi√™n Y',
    luckyNumbers: ['2', '1', '3'], 
    combinations: ['21', '12', '31', '13', '23', '32'],
    description: 'H·ªó tr·ª£ ƒë∆∞a ra quy·∫øt ƒë·ªãnh ƒë·∫ßu t∆∞ ƒë√∫ng ƒë·∫Øn, gi·∫£m thi·ªÉu r·ªßi ro'
  }
}

// C·∫∑p s·ªë t∆∞∆°ng ·ª©ng v·ªõi c√°c sao
const starNumbers = {
  'SINH_KHI': ['14', '41', '67', '76', '39', '93', '28', '82'],
  'THIEN_Y': ['13', '31', '68', '86', '49', '94', '27', '72'],
  'DIEN_NIEN': ['19', '91', '78', '87', '34', '43', '26', '62'],
  'NGU_QUY': ['18', '81', '79', '97', '36', '63', '24', '42'],
  'TUYET_MENH': ['12', '21', '69', '96', '84', '48', '73', '37']
}

// Ph∆∞∆°ng th·ª©c
const decrementLength = () => {
  if (passwordLength.value > 4) {
    passwordLength.value--
  }
}

const incrementLength = () => {
  if (passwordLength.value < 12) {
    passwordLength.value++
  }
}

const getStars = () => {
  return selectedPurpose.value ? fengShuiData[selectedPurpose.value].stars : ''
}

const getPurposeDescription = () => {
  return selectedPurpose.value ? fengShuiData[selectedPurpose.value].description : ''
}

const generatePasswordExplanation = (password) => {
  let explanation = "Ph√¢n t√≠ch: "
  const pairs = []
  
  // Ph√¢n t√≠ch d√£y s·ªë t·ª´ng c·∫∑p t·ª´ tr√°i qua ph·∫£i
  for (let i = 0; i < password.length - 1; i++) {
    const pair = password.substr(i, 2)
    let starType = ""
    
    // X√°c ƒë·ªãnh lo·∫°i sao
    if (starNumbers.SINH_KHI.includes(pair)) {
      starType = "Sinh Kh√≠"
    } else if (starNumbers.THIEN_Y.includes(pair)) {
      starType = "Thi√™n Y"
    } else if (starNumbers.DIEN_NIEN.includes(pair)) {
      starType = "Di√™n Ni√™n"
    } else if (starNumbers.NGU_QUY.includes(pair)) {
      starType = "Ng≈© Qu·ª∑"
    } else if (starNumbers.TUYET_MENH.includes(pair)) {
      starType = "Tuy·ªát M·ªánh"
    } else if (['11', '22', '33', '44', '66', '77', '88', '99'].includes(pair)) {
      starType = "Ph·ª•c V·ªã"
    } else {
      continue
    }
    
    pairs.push(`${pair}(${starType})`)
  }
  
  if (pairs.length > 0) {
    explanation += pairs.join(" + ")
  } else {
    explanation = "M·∫≠t kh·∫©u phong th·ªßy theo m·ª•c ƒë√≠ch ƒë√£ ch·ªçn"
  }
  
  // Ki·ªÉm tra s·ªë cu·ªëi c√πng
  const lastPair = password.slice(-2)
  if (lastPair.includes('0')) {
    explanation += " - L∆∞u √Ω: C√≥ s·ªë 0 ·ªü cu·ªëi (kh√¥ng t·ªët)"
  }
  
  // Ki·ªÉm tra n·∫øu c·∫∑p cu·ªëi l√† hung tinh
  if (starNumbers.NGU_QUY.includes(lastPair) || starNumbers.TUYET_MENH.includes(lastPair)) {
    explanation += " - L∆∞u √Ω: K·∫øt th√∫c b·∫±ng hung tinh (kh√¥ng t·ªët)"
  }
  
  // Ki·ªÉm tra n·∫øu c√≥ 2 hung tinh li·ªÅn k·ªÅ
  let hasConsecutiveNegativeStars = false
  for (let i = 0; i < pairs.length - 1; i++) {
    const currentStarType = pairs[i].includes("Ng≈© Qu·ª∑") || pairs[i].includes("Tuy·ªát M·ªánh")
    const nextStarType = pairs[i+1].includes("Ng≈© Qu·ª∑") || pairs[i+1].includes("Tuy·ªát M·ªánh")
    
    if (currentStarType && nextStarType) {
      hasConsecutiveNegativeStars = true
      break
    }
  }
  
  if (hasConsecutiveNegativeStars) {
    explanation += " - L∆∞u √Ω: C√≥ hai hung tinh li·ªÅn k·ªÅ (kh√¥ng t·ªët)"
  }
  
  return explanation
}

const generatePasswords = () => {
  if (!selectedPurpose.value) return
  
  const combinations = fengShuiData[selectedPurpose.value].combinations
  const luckyNumbers = fengShuiData[selectedPurpose.value].luckyNumbers
  
  suggestedPasswords.value = []
  passwordExplanations.value = []
  
  for (let i = 0; i < 4; i++) {
    // Ch·ªçn ng·∫´u nhi√™n m·ªôt trong c√°c chu·ªói g·ªëc
    const baseCombination = combinations[Math.floor(Math.random() * combinations.length)]
    let password = baseCombination
    
    // Ki·ªÉm tra xem chu·ªói g·ªëc c√≥ ph·∫£i l√† hung tinh kh√¥ng
    const isNegativeStar = 
      starNumbers.NGU_QUY.includes(baseCombination) || 
      starNumbers.TUYET_MENH.includes(baseCombination)
    
    // Ph∆∞∆°ng ph√°p t·∫°o m·∫≠t kh·∫©u
    const method = Math.floor(Math.random() * 3)
    
    if (method === 0) {
      // N·∫øu chu·ªói g·ªëc l√† hung tinh, ti·∫øp theo ch·ªâ th√™m c√°t tinh ho·∫∑c s·ªë ng·∫´u nhi√™n
      if (isNegativeStar) {
        // Ch·ªçn m·ªôt c·∫∑p c√°t tinh ƒë·ªÉ th√™m v√†o
        const goodStarPairs = [...starNumbers.SINH_KHI, ...starNumbers.THIEN_Y, ...starNumbers.DIEN_NIEN]
        const nextPair = goodStarPairs[Math.floor(Math.random() * goodStarPairs.length)]
        password += nextPair.charAt(0)
      }
      
      // Th√™m s·ªë ng·∫´u nhi√™n t·ª´ danh s√°ch s·ªë may m·∫Øn ƒë·∫øn khi ƒë·ªß ƒë·ªô d√†i - 2
      while (password.length < passwordLength.value - 2) {
        // Ki·ªÉm tra xem s·ªë cu·ªëi hi·ªán t·∫°i c√≥ th·ªÉ t·∫°o th√†nh hung tinh v·ªõi s·ªë ti·∫øp theo kh√¥ng
        const lastDigit = password.charAt(password.length - 1)
        
        // L·ªçc ra c√°c s·ªë may m·∫Øn kh√¥ng t·∫°o th√†nh hung tinh v·ªõi s·ªë cu·ªëi
        const safeNumbers = luckyNumbers.filter(num => {
          const potentialPair = lastDigit + num
          return !(starNumbers.NGU_QUY.includes(potentialPair) || 
                 starNumbers.TUYET_MENH.includes(potentialPair))
        })
        
        // N·∫øu kh√¥ng c√≥ s·ªë an to√†n, ch·ªçn s·ªë ng·∫´u nhi√™n t·ª´ danh s√°ch g·ªëc
        const numberPool = safeNumbers.length > 0 ? safeNumbers : luckyNumbers        
        const randomLuckyNumber = luckyNumbers[Math.floor(Math.random() * luckyNumbers.length)]
        password += randomLuckyNumber
      }
      
      // ƒê·∫£m b·∫£o k·∫øt th√∫c b·∫±ng c·∫∑p s·ªë t·ªët (Sinh Kh√≠ ho·∫∑c Thi√™n Y ho·∫∑c Di√™n Ni√™n)
      const goodEndingPairs = [...starNumbers.SINH_KHI, ...starNumbers.THIEN_Y, ...starNumbers.DIEN_NIEN]
      const endingPair = goodEndingPairs[Math.floor(Math.random() * goodEndingPairs.length)]
      
      // Ki·ªÉm tra xem s·ªë cu·ªëi c√πng tr∆∞·ªõc khi th√™m c·∫∑p k·∫øt th√∫c c√≥ t·∫°o th√†nh hung tinh kh√¥ng
      const lastDigit = password.charAt(password.length - 1)
      const firstDigitOfEnding = endingPair.charAt(0)
      const potentialPair = lastDigit + firstDigitOfEnding
      
      if (starNumbers.NGU_QUY.includes(potentialPair) || starNumbers.TUYET_MENH.includes(potentialPair)) {
        // N·∫øu t·∫°o th√†nh hung tinh, ch·ªçn m·ªôt c·∫∑p k·∫øt th√∫c kh√°c ho·∫∑c thay ƒë·ªïi s·ªë cu·ªëi
        const safeEndingPairs = goodEndingPairs.filter(pair => 
          !starNumbers.NGU_QUY.includes(lastDigit + pair.charAt(0)) && 
          !starNumbers.TUYET_MENH.includes(lastDigit + pair.charAt(0))
        )
        
        if (safeEndingPairs.length > 0) {
          // N·∫øu c√≥ c·∫∑p an to√†n, s·ª≠ d·ª•ng c·∫∑p ƒë√≥
          const safeEndingPair = safeEndingPairs[Math.floor(Math.random() * safeEndingPairs.length)]
          password += safeEndingPair
        } else {
          // N·∫øu kh√¥ng c√≥ c·∫∑p an to√†n, thay ƒë·ªïi s·ªë cu·ªëi
          password = password.substring(0, password.length - 1) + '5' + endingPair
        }
      } else {
        password += endingPair
      }
    } else if (method === 1) {
      // T∆∞∆°ng t·ª± nh∆∞ tr√™n, n·∫øu chu·ªói g·ªëc l√† hung tinh, ti·∫øp theo ch·ªâ th√™m c√°t tinh
      if (isNegativeStar) {
        const goodStarPairs = [...starNumbers.SINH_KHI, ...starNumbers.THIEN_Y, ...starNumbers.DIEN_NIEN]
        const nextPair = goodStarPairs[Math.floor(Math.random() * goodStarPairs.length)]
        password += nextPair.charAt(0)
      }
      
      // Th√™m s·ªë 5 ·ªü v·ªã tr√≠ ph√π h·ª£p
      while (password.length < passwordLength.value - 3) {
        // T∆∞∆°ng t·ª±, tr√°nh t·∫°o th√†nh hung tinh li√™n ti·∫øp
        const lastDigit = password.charAt(password.length - 1)
        const safeNumbers = luckyNumbers.filter(num => {
          const potentialPair = lastDigit + num
          return !(starNumbers.NGU_QUY.includes(potentialPair) || 
                 starNumbers.TUYET_MENH.includes(potentialPair))
        })
        
        const numberPool = safeNumbers.length > 0 ? safeNumbers : luckyNumbers
        const randomLuckyNumber = luckyNumbers[Math.floor(Math.random() * luckyNumbers.length)]
        password += randomLuckyNumber
      }
      
      password += "5"
      
      // ƒê·∫£m b·∫£o k·∫øt th√∫c b·∫±ng c·∫∑p s·ªë t·ªët
      const goodEndingPairs = [...starNumbers.SINH_KHI, ...starNumbers.THIEN_Y, ...starNumbers.DIEN_NIEN]
      const endingPair = goodEndingPairs[Math.floor(Math.random() * goodEndingPairs.length)]
      
      // Ki·ªÉm tra s·ªë "5" c√≥ t·∫°o th√†nh hung tinh v·ªõi s·ªë ƒë·∫ßu ti√™n c·ªßa c·∫∑p k·∫øt th√∫c kh√¥ng
      const potentialPair = "5" + endingPair.charAt(0)
      if (starNumbers.NGU_QUY.includes(potentialPair) || starNumbers.TUYET_MENH.includes(potentialPair)) {
        // N·∫øu t·∫°o th√†nh hung tinh, ch·ªçn c·∫∑p k·∫øt th√∫c kh√°c
        const safeEndingPairs = goodEndingPairs.filter(pair => 
          !starNumbers.NGU_QUY.includes("5" + pair.charAt(0)) && 
          !starNumbers.TUYET_MENH.includes("5" + pair.charAt(0))
        )
        
        if (safeEndingPairs.length > 0) {
          const safeEndingPair = safeEndingPairs[Math.floor(Math.random() * safeEndingPairs.length)]
          password += safeEndingPair.charAt(0) + safeEndingPair.charAt(1)
        } else {
          // N·∫øu kh√¥ng c√≥ c·∫∑p an to√†n, thay "5" b·∫±ng m·ªôt s·ªë kh√°c
          password = password.substring(0, password.length - 1) + "7" + endingPair.charAt(0) + endingPair.charAt(1)
        }
      } else {
        password += endingPair.charAt(0) + endingPair.charAt(1)
      }
    } else {
      // T∆∞∆°ng t·ª±, n·∫øu chu·ªói g·ªëc l√† hung tinh, ti·∫øp theo ch·ªâ th√™m c√°t tinh
      if (isNegativeStar) {
        const goodStarPairs = [...starNumbers.SINH_KHI, ...starNumbers.THIEN_Y, ...starNumbers.DIEN_NIEN]
        const nextPair = goodStarPairs[Math.floor(Math.random() * goodStarPairs.length)]
        password += nextPair.charAt(0)
      }
      
      // Th√™m d√£y Ph·ª•c V·ªã 
      while (password.length < passwordLength.value - 4) {
        // T∆∞∆°ng t·ª±, tr√°nh t·∫°o th√†nh hung tinh li√™n ti·∫øp
        const lastDigit = password.charAt(password.length - 1)
        const safeNumbers = luckyNumbers.filter(num => {
          const potentialPair = lastDigit + num
          return !(starNumbers.NGU_QUY.includes(potentialPair) || 
                 starNumbers.TUYET_MENH.includes(potentialPair))
        })
        
        const numberPool = safeNumbers.length > 0 ? safeNumbers : luckyNumbers
        const randomLuckyNumber = luckyNumbers[Math.floor(Math.random() * luckyNumbers.length)]
        password += randomLuckyNumber
      }
      
      const phucViSet = ['11', '22', '88', '99']
      const phucVi = phucViSet[Math.floor(Math.random() * phucViSet.length)]
      
      // Ki·ªÉm tra s·ªë cu·ªëi c√≥ t·∫°o th√†nh hung tinh v·ªõi Ph·ª•c V·ªã kh√¥ng
      const lastDigit = password.charAt(password.length - 1)
      const firstDigitOfPhucVi = phucVi.charAt(0)
      const potentialPair = lastDigit + firstDigitOfPhucVi
      
      if (starNumbers.NGU_QUY.includes(potentialPair) || starNumbers.TUYET_MENH.includes(potentialPair)) {
        // N·∫øu t·∫°o th√†nh hung tinh, ch·ªçn m·ªôt Ph·ª•c V·ªã kh√°c
        const safePhucVi = phucViSet.filter(pv => 
          !starNumbers.NGU_QUY.includes(lastDigit + pv.charAt(0)) && 
          !starNumbers.TUYET_MENH.includes(lastDigit + pv.charAt(0))
        )
        
        if (safePhucVi.length > 0) {
          password += safePhucVi[Math.floor(Math.random() * safePhucVi.length)]
        } else {
          // N·∫øu kh√¥ng c√≥ Ph·ª•c V·ªã an to√†n, thay ƒë·ªïi s·ªë cu·ªëi
          password = password.substring(0, password.length - 1) + '5' + phucVi
        }
      } else {
        password += phucVi
      }
      
      // ƒê·∫£m b·∫£o k·∫øt th√∫c b·∫±ng c·∫∑p s·ªë t·ªët
      const goodEndingPairs = [...starNumbers.SINH_KHI, ...starNumbers.THIEN_Y, ...starNumbers.DIEN_NIEN]
      const endingPair = goodEndingPairs[Math.floor(Math.random() * goodEndingPairs.length)]
      
      // Ki·ªÉm tra s·ªë cu·ªëi c·ªßa Ph·ª•c V·ªã c√≥ t·∫°o th√†nh hung tinh v·ªõi c·∫∑p k·∫øt th√∫c kh√¥ng
      const lastDigitOfPhucVi = password.charAt(password.length - 1)
      const firstDigitOfEnding = endingPair.charAt(0)
      const potentialPairWithEnding = lastDigitOfPhucVi + firstDigitOfEnding
      
      if (starNumbers.NGU_QUY.includes(potentialPairWithEnding) || 
          starNumbers.TUYET_MENH.includes(potentialPairWithEnding)) {
        // N·∫øu t·∫°o th√†nh hung tinh, ch·ªçn c·∫∑p k·∫øt th√∫c kh√°c
        const safeEndingPairs = goodEndingPairs.filter(pair => 
          !starNumbers.NGU_QUY.includes(lastDigitOfPhucVi + pair.charAt(0)) && 
          !starNumbers.TUYET_MENH.includes(lastDigitOfPhucVi + pair.charAt(0))
        )
        
        if (safeEndingPairs.length > 0) {
          password += safeEndingPairs[Math.floor(Math.random() * safeEndingPairs.length)]
        } else {
          // N·∫øu kh√¥ng c√≥ c·∫∑p an to√†n, th√™m m·ªôt s·ªë ƒë·ªám
          password += '9' + endingPair
        }
      } else {
        password += endingPair
      }
    }
    
    // C·∫Øt b·ªõt n·∫øu d√†i h∆°n y√™u c·∫ßu, nh∆∞ng gi·ªØ nguy√™n 2 s·ªë cu·ªëi
    if (password.length > passwordLength.value) {
      const endingPair = password.slice(-2)
      password = password.substring(0, passwordLength.value - 2) + endingPair
    }
    
    suggestedPasswords.value.push(password)
    passwordExplanations.value.push(generatePasswordExplanation(password))
  }
}

const copyToClipboard = (text) => {
  navigator.clipboard.writeText(text)
    .then(() => {
      alert('ƒê√£ sao ch√©p: ' + text)
    })
    .catch(err => {
      console.error('L·ªói khi sao ch√©p: ', err)
    })
}

// Theo d√µi thay ƒë·ªïi v√† t·∫°o m·∫≠t kh·∫©u m·ªõi
watch([selectedPurpose, passwordLength], () => {
  if (selectedPurpose.value) {
    generatePasswords()
  }
})
</script> 

<style scoped>
:root {
  --primary-color: #4361ee;
  --primary-light: #e7ecfd;
  --primary-dark: #3a50d8;
}

.text-primary { color: var(--primary-color); }
.bg-primary { background-color: var(--primary-color); }
.border-primary { border-color: var(--primary-color); }
.bg-primary-light { background-color: var(--primary-light); }
.bg-primary-dark { background-color: var(--primary-dark); }
.hover\:border-primary:hover { border-color: var(--primary-color); }
.hover\:bg-primary-dark:hover { background-color: var(--primary-dark); }
</style> 