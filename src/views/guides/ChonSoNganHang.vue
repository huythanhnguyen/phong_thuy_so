<template>
  <div class="min-h-screen flex flex-col">
    <!-- Header -->
    <Header />

    <main class="flex-grow container mx-auto px-4 py-12">
      <div class="max-w-4xl mx-auto">
        <h1 class="text-4xl font-bold text-gray-800 mb-8 text-center">Ch·ªçn S·ªë T√†i Kho·∫£n Ng√¢n H√†ng H·ª£p Phong Th·ªßy</h1>
        
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
          <p class="text-lg text-gray-700 mb-6">
            S·ªë t√†i kho·∫£n ng√¢n h√†ng kh√¥ng ch·ªâ l√† m·ªôt d√£y s·ªë th√¥ng th∆∞·ªùng m√† c√≤n c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn nƒÉng l∆∞·ª£ng t√†i ch√≠nh c·ªßa b·∫°n theo quan ƒëi·ªÉm phong th·ªßy.
          </p>
          
          <div class="border-l-4 border-primary p-4 bg-primary-light mb-8">
            <h3 class="font-bold text-lg mb-2">L∆∞u √Ω quan tr·ªçng</h3>
            <p>Hi·ªán nay m·ªôt s·ªë ng√¢n h√†ng cho ph√©p kh√°ch h√†ng ch·ªçn s·ªë t√†i kho·∫£n. Vi·ªác ch·ªçn m·ªôt s·ªë t√†i kho·∫£n h·ª£p l√Ω s·∫Ω gi√∫p gi·ªØ ti·ªÅn ho·∫∑c ti√™u d√πng th√¥ng minh h∆°n.</p>
          </div>
          
          <div class="border-l-4 border-yellow-500 p-4 bg-yellow-50 mb-8">
            <h3 class="font-bold text-lg text-yellow-700 mb-2">C√°c nguy√™n t·∫Øc ch·ªçn s·ªë t√†i kho·∫£n</h3>
            <ul class="list-disc pl-5 space-y-2 text-gray-700">
              <li><strong>Ph∆∞∆°ng ph√°p ph√¢n t√≠ch:</strong> D√£y s·ªë ƒë∆∞·ª£c ph√¢n t√≠ch t·ª´ng c·∫∑p t·ª´ tr√°i qua ph·∫£i, ƒë·∫∑c bi·ªát quan tr·ªçng l√† c·∫∑p s·ªë cu·ªëi</li>
              <li><strong>Tr·ªçng ƒëi·ªÉm:</strong> 2-4 s·ªë cu·ªëi c·ªßa m√£ t√†i kho·∫£n c√≥ ·∫£nh h∆∞·ªüng l·ªõn ƒë·∫øn nƒÉng l∆∞·ª£ng t√†i ch√≠nh</li>
              <li><strong>Di√™n Ni√™n</strong> (19, 91, 34, 43) th√≠ch h·ª£p cho ti·∫øt ki·ªám, gi·ªØ ti·ªÅn l√¢u d√†i</li>
              <li><strong>Thi√™n Y</strong> (13, 31) mang ƒë·∫øn may m·∫Øn v·ªÅ t√†i l·ªôc, ki·∫øm ti·ªÅn</li>
              <li><strong>Sinh Kh√≠</strong> (14, 41, 39, 93) h·ªó tr·ª£ cho s·ª©c kh·ªèe t√†i ch√≠nh</li>
              <li><strong>Tuy·ªát ƒë·ªëi tr√°nh:</strong> S·ªë 0 ·ªü cu·ªëi d√£y s·ªë ho·∫∑c c√°c hung tinh (Ng≈© Qu·ª∑, Tuy·ªát M·ªánh) ·ªü cu·ªëi</li>
            </ul>
          </div>
        </div>

        <!-- Ph·∫ßn ch·ªçn m·ª•c ƒë√≠ch -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">M·ª•c ƒë√≠ch s·ª≠ d·ª•ng t√†i kho·∫£n</h2>
          <p class="mb-4">Ch·ªçn m·ª•c ƒë√≠ch s·ª≠ d·ª•ng t√†i kho·∫£n ƒë·ªÉ nh·∫≠n g·ª£i √Ω s·ªë ph√π h·ª£p</p>
          
          <div class="grid md:grid-cols-3 gap-4 mb-6">
            <div 
              v-for="(purpose, index) in purposes" 
              :key="index"
              class="border rounded-lg p-4 cursor-pointer transition-all duration-300"
              :class="selectedPurpose === purpose.value ? 'border-primary bg-primary-light shadow-md' : 'border-gray-200 hover:border-primary hover:shadow'"
              @click="selectedPurpose = purpose.value"
            >
              <div class="flex items-center">
                <div class="w-5 h-5 rounded-full border mr-3 flex items-center justify-center" 
                     :class="selectedPurpose === purpose.value ? 'border-primary' : 'border-gray-400'">
                  <div v-if="selectedPurpose === purpose.value" class="w-3 h-3 rounded-full bg-primary"></div>
                </div>
                <span>{{ purpose.label }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Ph·∫ßn ƒë·ªô d√†i s·ªë t√†i kho·∫£n -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">ƒê·ªô d√†i s·ªë t√†i kho·∫£n</h2>
          <p class="mb-4">Ch·ªçn ƒë·ªô d√†i mong mu·ªën cho s·ªë t√†i kho·∫£n c·ªßa b·∫°n</p>
          
          <div class="flex items-center mb-6">
            <button 
              @click="decrementLength" 
              class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center hover:bg-gray-300 focus:outline-none"
              :disabled="accountLength <= 6"
            >
              <span class="text-xl">-</span>
            </button>
            
            <div class="mx-4 px-6 py-2 border rounded-lg text-center min-w-[80px]">
              {{ accountLength }}
            </div>
            
            <button 
              @click="incrementLength" 
              class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center hover:bg-gray-300 focus:outline-none"
              :disabled="accountLength >= 12"
            >
              <span class="text-xl">+</span>
            </button>
          </div>
        </div>

        <!-- Ph·∫ßn g·ª£i √Ω s·ªë t√†i kho·∫£n -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">S·ªë t√†i kho·∫£n g·ª£i √Ω</h2>
          
          <div v-if="!selectedPurpose" class="text-center py-6 text-gray-500">
            Vui l√≤ng ch·ªçn m·ª•c ƒë√≠ch s·ª≠ d·ª•ng ƒë·ªÉ nh·∫≠n g·ª£i √Ω
          </div>
          
          <div v-else>
            <div class="mb-6">
              <p class="mb-2">C·∫∑p sao t∆∞∆°ng ·ª©ng: <span class="font-semibold">{{ getStars() }}</span></p>
              <p class="mt-2 text-gray-600 text-sm">{{ getPurposeDescription() }}</p>
              <div class="mt-4 border-l-4 border-primary p-4 bg-primary-light">
                <h4 class="font-bold mb-2">H∆∞·ªõng d·∫´n c·∫∑p s·ªë cu·ªëi</h4>
                <p class="text-sm" v-if="selectedPurpose === 'saving'">
                  D√πng <strong>Di√™n Ni√™n</strong> (19, 91, 34, 43) ·ªü cu·ªëi t√†i kho·∫£n ti·∫øt ki·ªám gi√∫p thu h√∫t ti·ªÅn b·∫°c, gi·ªØ ti·ªÅn t·ªët.
                </p>
                <p class="text-sm" v-else-if="selectedPurpose === 'investment'">
                  K·∫øt h·ª£p <strong>Tuy·ªát M·ªánh + Thi√™n Y</strong> (21 + 13) gi√∫p th·ª©c t·ªânh n·ªó l·ª±c ph·∫•n ƒë·∫•u, hi·ªÉu ƒë∆∞·ª£c t√≠nh to√°n, k·∫ø ho·∫°ch d√πng ti·ªÅn.
                </p>
                <p class="text-sm" v-else-if="selectedPurpose === 'spending'">
                  M√£ s·ªë t√†i kho·∫£n c√≥ c·∫∑p s·ªë cu·ªëi thu·ªôc <strong>Thi√™n Y</strong> (13, 31, 68, 86) s·∫Ω gi√∫p thu h√∫t t√†i l·ªôc v√† ti√™u d√πng th√¥ng minh.
                </p>
              </div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-4 mb-6">
              <div v-for="(account, index) in suggestedAccounts" :key="index" 
                class="border border-gray-200 rounded-lg p-4 relative hover:shadow-md transition-shadow">
                <div class="text-xl font-mono mb-2 text-center">{{ account }}</div>
                <div class="text-xs text-gray-500 text-center mb-2">{{ accountExplanations[index] }}</div>
                <button 
                  @click="copyToClipboard(account)" 
                  class="absolute top-2 right-2 text-gray-500 hover:text-primary"
                  title="Sao ch√©p"
                >
                  <span>üìã</span>
                </button>
              </div>
            </div>
            
            <div class="text-center">
              <button 
                @click="generateAccounts" 
                class="px-6 py-3 bg-primary text-white rounded-md hover:bg-primary-dark transition-colors shadow-md"
              >
                G·ª£i √Ω s·ªë kh√°c
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <Footer />
  </div>
</template>

<script setup>
import { ref, watch } from 'vue'
import Header from '@/components/layout/Header.vue'
import Footer from '@/components/layout/Footer.vue'

// Tr·∫°ng th√°i
const selectedPurpose = ref('')
const accountLength = ref(10)
const suggestedAccounts = ref([])
const accountExplanations = ref([])

// Danh s√°ch m·ª•c ƒë√≠ch
const purposes = [
  { value: 'saving', label: 'Ti·∫øt ki·ªám' },
  { value: 'investment', label: 'ƒê·∫ßu t∆∞' },
  { value: 'spending', label: 'Ti√™u d√πng' }
]

// D·ªØ li·ªáu phong th·ªßy
const fengShuiData = {
  saving: {
    stars: 'Di√™n Ni√™n',
    luckyNumbers: ['1', '3', '9', '4'], 
    combinations: ['19', '91', '34', '43', '78', '87'],
    description: 'S·ªë t√†i kho·∫£n Di√™n Ni√™n th·ª≠ t√†i h√†o, hi·ªÉu ƒë∆∞·ª£c t√≠nh to√°n, k·∫ø ho·∫°ch d√πng ti·ªÅn. Ti·∫øt ki·ªám ti·ªÅn!'
  },
  investment: {
    stars: 'Tuy·ªát M·ªánh + Thi√™n Y',
    luckyNumbers: ['2', '1', '3'], 
    combinations: ['21', '12', '31', '13', '23', '32'],
    description: 'M·∫∑t m√£ th·∫ª ng√¢n h√†ng, s·ªë t√†i kho·∫£n, ·ª©ng l·∫•y th·ª≠ T√†i l√† t·ªët. ƒê·∫ßu t∆∞ hi·ªáu qu·∫£, sinh l·ªùi.'
  },
  spending: {
    stars: 'Thi√™n Y',
    luckyNumbers: ['1', '3', '9'], 
    combinations: ['13', '31', '68', '86', '49', '94'],
    description: 'Thi√™n Y th·ª≠ T√†i gi√∫p ti√™u d√πng th√¥ng minh, chi ti√™u h·ª£p l√Ω v√† thu h√∫t t√†i l·ªôc.'
  }
}

// C·∫∑p s·ªë t∆∞∆°ng ·ª©ng v·ªõi c√°c sao
const starNumbers = {
  'SINH_KHI': ['14', '41', '67', '76', '39', '93', '28', '82'],
  'THIEN_Y': ['13', '31', '68', '86', '49', '94', '27', '72'],
  'DIEN_NIEN': ['19', '91', '78', '87', '34', '43', '26', '62'],
  'NGU_QUY': ['18', '81', '79', '97', '36', '63', '24', '42'],
  'TUYET_MENH': ['12', '21', '69', '96', '84', '48', '73', '37']
}

// Ph∆∞∆°ng th·ª©c
const decrementLength = () => {
  if (accountLength.value > 6) {
    accountLength.value--
  }
}

const incrementLength = () => {
  if (accountLength.value < 12) {
    accountLength.value++
  }
}

const getStars = () => {
  return selectedPurpose.value ? fengShuiData[selectedPurpose.value].stars : ''
}

const getPurposeDescription = () => {
  return selectedPurpose.value ? fengShuiData[selectedPurpose.value].description : ''
}

const generateAccountExplanation = (account) => {
  let explanation = "Ph√¢n t√≠ch: "
  const pairs = []
  
  // Ph√¢n t√≠ch d√£y s·ªë t·ª´ng c·∫∑p t·ª´ tr√°i qua ph·∫£i
  for (let i = 0; i < account.length - 1; i++) {
    const pair = account.substr(i, 2)
    let starType = ""
    
    // X√°c ƒë·ªãnh lo·∫°i sao
    if (starNumbers.SINH_KHI.includes(pair)) {
      starType = "Sinh Kh√≠"
    } else if (starNumbers.THIEN_Y.includes(pair)) {
      starType = "Thi√™n Y"
    } else if (starNumbers.DIEN_NIEN.includes(pair)) {
      starType = "Di√™n Ni√™n"
    } else if (starNumbers.NGU_QUY.includes(pair)) {
      starType = "Ng≈© Qu·ª∑"
    } else if (starNumbers.TUYET_MENH.includes(pair)) {
      starType = "Tuy·ªát M·ªánh"
    } else if (['11', '22', '33', '44', '66', '77', '88', '99'].includes(pair)) {
      starType = "Ph·ª•c V·ªã"
    } else {
      continue
    }
    
    pairs.push(`${pair}(${starType})`)
  }
  
  if (pairs.length > 0) {
    explanation += pairs.join(" + ")
  } else {
    explanation = "S·ªë t√†i kho·∫£n phong th·ªßy theo m·ª•c ƒë√≠ch ƒë√£ ch·ªçn"
  }
  
  // Ki·ªÉm tra s·ªë cu·ªëi c√πng
  const lastPair = account.slice(-2)
  if (lastPair.includes('0')) {
    explanation += " - L∆∞u √Ω: C√≥ s·ªë 0 ·ªü cu·ªëi (kh√¥ng t·ªët)"
  }
  
  // Ki·ªÉm tra n·∫øu c·∫∑p cu·ªëi l√† hung tinh
  if (starNumbers.NGU_QUY.includes(lastPair) || starNumbers.TUYET_MENH.includes(lastPair)) {
    explanation += " - L∆∞u √Ω: K·∫øt th√∫c b·∫±ng hung tinh (kh√¥ng t·ªët)"
  }
  
  // Ki·ªÉm tra n·∫øu c√≥ 2 hung tinh li·ªÅn k·ªÅ
  let hasConsecutiveNegativeStars = false
  for (let i = 0; i < pairs.length - 1; i++) {
    const currentStarType = pairs[i].includes("Ng≈© Qu·ª∑") || pairs[i].includes("Tuy·ªát M·ªánh")
    const nextStarType = pairs[i+1].includes("Ng≈© Qu·ª∑") || pairs[i+1].includes("Tuy·ªát M·ªánh")
    
    if (currentStarType && nextStarType) {
      hasConsecutiveNegativeStars = true
      break
    }
  }
  
  if (hasConsecutiveNegativeStars) {
    explanation += " - L∆∞u √Ω: C√≥ hai hung tinh li·ªÅn k·ªÅ (kh√¥ng t·ªët)"
  }
  
  return explanation
}

const isNegativeStar = (pair) => {
  return starNumbers.NGU_QUY.includes(pair) || starNumbers.TUYET_MENH.includes(pair);
}

const generateAccounts = () => {
  if (!selectedPurpose.value) return
  
  const combinations = fengShuiData[selectedPurpose.value].combinations
  const luckyNumbers = fengShuiData[selectedPurpose.value].luckyNumbers
  
  suggestedAccounts.value = []
  accountExplanations.value = []
  
  for (let i = 0; i < 4; i++) {
    let account = '';
    let validAccount = false;
    
    // Th·ª≠ t·∫°o t√†i kho·∫£n cho ƒë·∫øn khi c√≥ m·ªôt t√†i kho·∫£n h·ª£p l·ªá
    while (!validAccount) {
      // Ch·ªçn ng·∫´u nhi√™n m·ªôt trong c√°c chu·ªói g·ªëc cho ph·∫ßn cu·ªëi
      const endingPair = combinations[Math.floor(Math.random() * combinations.length)]
      
      // S·ªë t√†i kho·∫£n ng√¢n h√†ng th∆∞·ªùng c√≥ ƒë·ªãnh d·∫°ng c·ªë ƒë·ªãnh, t·∫°o ph·∫ßn prefix
      let prefix = '';
      let previousDigit = '';
      let currentPair = '';
      
      for (let j = 0; j < accountLength.value - 2; j++) {
        // N·∫øu ƒë√£ c√≥ √≠t nh·∫•t m·ªôt ch·ªØ s·ªë, ki·ªÉm tra xem c√≥ th·ªÉ t·∫°o th√†nh c·∫∑p hung tinh kh√¥ng
        if (j > 0) {
          const availableNumbers = luckyNumbers.filter(num => {
            const potentialPair = previousDigit + num;
            return !isNegativeStar(potentialPair);
          });
          
          if (availableNumbers.length > 0) {
            const randomIndex = Math.floor(Math.random() * availableNumbers.length);
            const safeNumber = availableNumbers[randomIndex];
            prefix += safeNumber;
            previousDigit = safeNumber;
          } else {
            // N·∫øu kh√¥ng c√≥ s·ªë an to√†n, s·ª≠ d·ª•ng m·ªôt s·ªë ng·∫´u nhi√™n t·ª´ danh s√°ch g·ªëc
            const randomLuckyNumber = luckyNumbers[Math.floor(Math.random() * luckyNumbers.length)];
            prefix += randomLuckyNumber;
            previousDigit = randomLuckyNumber;
          }
        } else {
          // S·ªë ƒë·∫ßu ti√™n c√≥ th·ªÉ l√† b·∫•t k·ª≥ s·ªë may m·∫Øn n√†o
          const randomLuckyNumber = luckyNumbers[Math.floor(Math.random() * luckyNumbers.length)];
          prefix += randomLuckyNumber;
          previousDigit = randomLuckyNumber;
        }
      }
      
      // Ki·ªÉm tra xem ch·ªØ s·ªë cu·ªëi c√πng c·ªßa prefix v√† ch·ªØ s·ªë ƒë·∫ßu ti√™n c·ªßa endingPair c√≥ t·∫°o th√†nh c·∫∑p hung tinh kh√¥ng
      const lastDigitOfPrefix = prefix.charAt(prefix.length - 1);
      const firstDigitOfEnding = endingPair.charAt(0);
      const potentialPair = lastDigitOfPrefix + firstDigitOfEnding;
      
      if (!isNegativeStar(potentialPair)) {
        // N·∫øu kh√¥ng t·∫°o th√†nh hung tinh, t√†i kho·∫£n h·ª£p l·ªá
        account = prefix + endingPair;
        
        // Ki·ªÉm tra th√™m m·ªôt l·∫ßn n·ªØa to√†n b·ªô t√†i kho·∫£n ƒë·ªÉ ƒë·∫£m b·∫£o kh√¥ng c√≥ c·∫∑p hung tinh n√†o
        let hasNegativePair = false;
        for (let k = 0; k < account.length - 1; k++) {
          const pair = account.substr(k, 2);
          if (isNegativeStar(pair)) {
            hasNegativePair = true;
            break;
          }
        }
        
        if (!hasNegativePair) {
          validAccount = true;
        }
      }
    }
    
    suggestedAccounts.value.push(account)
    accountExplanations.value.push(generateAccountExplanation(account))
  }
}

const copyToClipboard = (text) => {
  navigator.clipboard.writeText(text)
    .then(() => {
      alert('ƒê√£ sao ch√©p: ' + text)
    })
    .catch(err => {
      console.error('L·ªói khi sao ch√©p: ', err)
    })
}

// Theo d√µi thay ƒë·ªïi v√† t·∫°o g·ª£i √Ω m·ªõi
watch([selectedPurpose, accountLength], () => {
  if (selectedPurpose.value) {
    generateAccounts()
  }
})
</script>

<style scoped>
:root {
  --primary-color: #4361ee;
  --primary-light: #e7ecfd;
  --primary-dark: #3a50d8;
}

.text-primary { color: var(--primary-color); }
.bg-primary { background-color: var(--primary-color); }
.border-primary { border-color: var(--primary-color); }
.bg-primary-light { background-color: var(--primary-light); }
.bg-primary-dark { background-color: var(--primary-dark); }
.hover\:border-primary:hover { border-color: var(--primary-color); }
.hover\:bg-primary-dark:hover { background-color: var(--primary-dark); }
</style>